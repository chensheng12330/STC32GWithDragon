C251 COMPILER V5.57.0,  main                                                               05/02/23  16:58:09  PAGE 1   


C251 COMPILER V5.57.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\SoftWare\KeilARM\C251\BIN\C251.EXE main.c XSMALL BROWSE DEBUG PRINT(.\Listings\main.lst) TABS(2)
                    - OBJECT(.\Objects\main.obj) 

stmt  level    source

    1          //    @²¼¶¡éÙ³¤ 2023/02/04
    2          //    ÎåÏò¿ª¹Ø-ÉÏ¼ü£ºÊıÂë¹ÜÊı×Ö¼Ó£¬ÏÂ¼ü£ºÊıÂë¹ÜÊı×Ö¼õ£¬×ó¼ü£ºÊı×Ö×óÒÆÒ»Î»£¬ÓÒ¼ü£ºÊı×ÖÓÒÒÆÒ»Î»,ÖĞ¼ü£ºÇåÁãÊı×
             -Ö
    3          //    ÎåÏò¿ª¹ØÒı½Å¶¨Òå£ºÉÏ¼ü£ºP7.4 ÏÂ¼ü£ºP7.3 ×ó£ºP7.2 ÓÒ£ºP7.1 ÖĞ¼ü£ºP7.0 
    4          //    8Î»¹²Ñô¼«ÊıÂë¹ÜÄ£¿é-595¼¶ÁªÇı¶¯£ºDS(DIO):P6.6 SH(SCK):P6.5 ST(RCK):P6.4
    5          //    ÊµÑé¿ª·¢°å£ºSTC32G12K128-LQFP64 ÍÀÁúµ¶Èı.1  35MHz
    6          
    7          #include <STC32G.H>
    8          
    9          #define MAIN_Fosc 35000000UL    //¶¨ÒåÖ÷Æµ35MHz£¬Çë¸ù¾İÊµ¼ÊÊ¹ÓÃÆµÂÊĞŞ¸Ä£¨ÓÃÓÚdelayº¯Êı×ÔÊÊÓ¦Ö÷Æµ£©
   10          
   11          typedef unsigned char u8;       //unsigned char     ÀàĞÍÓÃ u8 ±íÊ¾
   12          typedef unsigned int u16;       //unsigned int      ÀàĞÍÓÃ u16±íÊ¾
   13          typedef unsigned long int u32;  //unsigned long int ÀàĞÍÓÃ u32±íÊ¾
   14          
   15          sbit DS = P6^6;           //´®ĞĞÊäÈëDS(DIO)½ÓP6.6
   16          sbit SH = P6^5;           //´®ĞĞÊäÈëÊ±ÖÓSH(SCK)½ÓP6.5
   17          sbit ST = P6^4;           //Ëø´æÊ±ÖÓST(RCK)½ÓP6.4
   18          
   19          sbit KEY_Up     = P7^4;   //ÉÏ¼ü£ºP7.4
   20          sbit KEY_Down   = P7^3;   //ÏÂ¼ü£ºP7.3
   21          sbit KEY_Left   = P7^2;   //×ó¼ü£ºP7.2
   22          sbit KEY_Right  = P7^1;   //ÓÒ¼ü£ºP7.1
   23          sbit KEY_Middle = P7^0;   //ÖĞ¼ü£ºP7.0
   24          
   25          void delayms(u16 ms);           //ÑÓÊ±º¯ÊıÉùÃ÷
   26          void Write595(u8 dat);          //595Ğ´Êı¾İº¯ÊıÉùÃ÷
   27          void Output595();               //595Êä³öÏÔÊ¾º¯ÊıÉùÃ÷
   28          void SEG_Disp(u8 dat,u8 wei);   //ÊıÂë¹ÜÏÔÊ¾º¯ÊıÉùÃ÷
   29          void keyscan();                 //°´¼üÉ¨Ãèº¯ÊıÉùÃ÷
   30          
   31          //¹²Ñô¼«¶ÎÂëÊı×é
   32          u8 SEG_Code[13] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,   //¹²ÑôÊıÂë¹Ü¶ÎÂë£º0~9,  
   33                              0xff,0xbf,0x00};  //ÊıÂë¹ÜÈ«Ãğ£¨10£©£¬ºá¸Ë-£¨11£©£¬ÊıÂë¹ÜÈ«ÁÁ£¨12£©
   34          //¹²Ñô¼«Î»ÂëÊı×é-4Î»ÊıÂë¹Ü
   35          u8 WEI_Code[8] = {0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};   //¹²Ñô¼«Î»ÂëÊı×é£¬COM1½Ó595Q0£¬COM2½ÓQ1...¼´
             -ÊıÂë¹Ü×ó±ßµÚÒ»Î»½ÓQ0...µÚ°ËÎ»½ÓQ7
   36          
   37          u8 keynum;          //°´¼üºÅ
   38          u8 number;          //ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö
   39          u8 seg_wei;         //Êı×ÖÏÔÊ¾µÄÎ»ÖÃ
   40          
   41          
   42          void main()
   43          {
   44   1        EAXFR = 1;        //Ê¹ÄÜXFR·ÃÎÊ
   45   1        CKCON = 0x00;     //ÉèÖÃÍâ²¿Êı¾İ×ÜÏßËÙ¶È×î¿ì
   46   1        WTST = 0x00;      //ÉèÖÃ³ÌĞò¶ÁÈ¡µÈ´ıÊ±¼äÎª0¸öÊ±ÖÓ£¬CPUÖ´ĞĞ³ÌĞòËÙ¶È×î¿ì
   47   1        
   48   1        P0M1 = 0x00;P0M0 = 0x00;    //ÉèÖÃP0¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   49   1        P1M1 = 0x00;P1M0 = 0x00;    //ÉèÖÃP1¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   50   1        P2M1 = 0x00;P2M0 = 0x00;    //ÉèÖÃP2¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   51   1        P3M1 = 0x00;P3M0 = 0x00;    //ÉèÖÃP3¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   52   1        P4M1 = 0x00;P4M0 = 0x00;    //ÉèÖÃP4¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   53   1        P5M1 = 0x00;P5M0 = 0x00;    //ÉèÖÃP5¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   54   1        P6M1 = 0x00;P6M0 = 0x00;    //ÉèÖÃP6¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   55   1        P7M1 = 0x00;P7M0 = 0x00;    //ÉèÖÃP7¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   56   1        
C251 COMPILER V5.57.0,  main                                                               05/02/23  16:58:09  PAGE 2   

   57   1        seg_wei = 4;      //³õÊ¼ÔÚÊıÂë¹Ü×ó±ßµÚ4Î»ÏÔÊ¾             
   58   1        while(1)
   59   1        {
   60   2          keyscan();                    //°´¼üÉ¨Ãè
   61   2          SEG_Disp(number,seg_wei);     //ÔÚµÚseg_weiÎ»ÏÔÊ¾Êı×Önumber
   62   2        }
   63   1      }
   64          void keyscan()
   65          {
   66   1        static u8 keystate_up,keystate_down,keystate_left,keystate_right,keystate_middle; //5¸ö°´¼üµÄ¿ªºÏ×´Ì¬£¨1
             -£º°´ÏÂ£¬0£ºËÉ¿ª£©
   67   1        if(KEY_Up == 0 && keystate_up == 0)           //ÉÏ¼ü°´ÏÂ
   68   1        {
   69   2          delayms(10);                                //ÑÓÊ±È¥¶¶
   70   2          if(KEY_Up == 0 && keystate_up == 0)         //ÔÙ´ÎÅĞ¶ÏÉÏ¼üÊÇ·ñ°´ÏÂ
   71   2          {
   72   3            keystate_up = 1;                          //ÉÏ¼ü×´Ì¬ÖÃ1£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   73   3            if(number <= 8) number++;                 //ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö+1£¬×î´óÖµ9
   74   3          }
   75   2        }
   76   1        if(KEY_Up == 1) keystate_up = 0;              //°´¼üËÉ¿ªºó£¬ÇåÁãÉÏ¼ü×´Ì¬£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   77   1        
   78   1        if(KEY_Down == 0 && keystate_down == 0)       //ÏÂ¼ü°´ÏÂ
   79   1        {
   80   2          delayms(10);                                //ÑÓÊ±È¥¶¶
   81   2          if(KEY_Down == 0 && keystate_down == 0)     //ÔÙ´ÎÅĞ¶ÏÏÂ¼üÊÇ·ñ°´ÏÂ
   82   2          {
   83   3            keystate_down = 1;                        //ÏÂ¼ü×´Ì¬ÖÃ1£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   84   3            if(number >= 1) number--;                 //ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö-1£¬×îĞ¡Öµ0
   85   3          }
   86   2        }
   87   1        if(KEY_Down == 1) keystate_down = 0;          //°´¼üËÉ¿ªºó£¬ÇåÁãÏÂ¼ü×´Ì¬£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   88   1        
   89   1        if(KEY_Left == 0 && keystate_left == 0)       //×ó¼ü°´ÏÂ
   90   1        {
   91   2          delayms(10);                                //ÑÓÊ±È¥¶¶
   92   2          if(KEY_Left == 0 && keystate_left == 0)     //ÔÙ´ÎÅĞ¶Ï×ó¼üÊÇ·ñ°´ÏÂ
   93   2          {
   94   3            keystate_left = 1;                        //×ó¼ü×´Ì¬ÖÃ1£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   95   3            if(seg_wei >= 1) seg_wei--;               //ÏÔÊ¾µÄÎ»ÖÃ¼õ1£¬×óÒÆÒ»Î» 
   96   3          }
   97   2        }
   98   1        if(KEY_Left == 1) keystate_left = 0;          //°´¼üËÉ¿ªºó£¬ÇåÁã×ó¼ü×´Ì¬£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
   99   1        
  100   1        if(KEY_Right == 0 && keystate_right == 0)     //ÓÒ¼ü°´ÏÂ
  101   1        {
  102   2          delayms(10);                                //ÑÓÊ±È¥¶¶
  103   2          if(KEY_Right == 0 && keystate_right == 0)   //ÔÙ´ÎÅĞ¶ÏÓÒ¼üÊÇ·ñ°´ÏÂ
  104   2          {
  105   3            keystate_right = 1;                       //ÓÒ¼ü×´Ì¬ÖÃ1£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
  106   3            if(seg_wei <= 7) seg_wei++;               //ÏÔÊ¾µÄÎ»ÖÃ+1£¬ÓÒÒÆÒ»Î»
  107   3          }
  108   2        }
  109   1        if(KEY_Right == 1) keystate_right = 0;        //ËÉ¿ª°´¼üºó£¬ÇåÁãÓÒ¼ü×´Ì¬£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
  110   1          
  111   1        if(KEY_Middle == 0 && keystate_middle == 0)   //ÖĞ¼ü°´ÏÂ
  112   1        {
  113   2          delayms(10);                                //ÑÓÊ±È¥¶¶
  114   2          if(KEY_Middle == 0 && keystate_middle == 0) //ÔÙ´ÎÅĞ¶ÏÖĞ¼üÊÇ·ñ°´ÏÂ
  115   2          {
  116   3            keystate_middle = 1;                      //ÖĞ¼ü×´Ì¬ÖÃ1£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
  117   3            number = 0;                               //ÇåÁãÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö
  118   3          }
  119   2        }
  120   1        if(KEY_Middle == 1) keystate_middle = 0;      //ËÉ¿ª°´¼üºó£¬ÇåÁãÖĞ¼ü×´Ì¬£¨1£º°´ÏÂ£¬0£ºËÉ¿ª£©
  121   1      }
C251 COMPILER V5.57.0,  main                                                               05/02/23  16:58:09  PAGE 3   

  122          void  delayms(u16 ms)   //¼òµ¥ÑÓÊ±º¯Êı£¬×ÔÊÊÓ¦Ö÷Æµ£¬1ºÁÃë*ms
  123          {
  124   1        u16 i;
  125   1        do{
  126   2            i = MAIN_Fosc / 6000;
  127   2            while(--i);
  128   2          }while(--ms);
  129   1      }
  130          void Write595(u8 dat)     //595Ğ´Êı¾İº¯Êı
  131          {
  132   1        u16 i;
  133   1        for(i = 0;i < 8;i++)    
  134   1        {
  135   2          SH = 0;               //À­µÍ´®ĞĞÊäÈëÊ±ÖÓSCLK
  136   2          DS = dat & 0x80;      //È¡×î¸ßÎ»
  137   2          SH = 1;               //SCKLÊ±ÖÓÉÏÉıÑØ£¬Êı¾İ´æÒÆÎ»¼Ä´æÆ÷
  138   2          dat <<= 1;            //Ã¿´ÎÒ»Î»
  139   2        }
  140   1      }
  141          void Output595()          //595Êä³öº¯Êı
  142          {
  143   1        ST = 0;                 //À­µÍSTÊ±ÖÓ
  144   1        ST = 1;                 //STÊ±ÖÓÉÏÉıÑØ£¬¸üĞÂÊä³ö´æ´¢Æ÷Êı¾İ
  145   1      }
  146          
  147          void SEG_Disp(u8 dat,u8 wei)      //ÊıÂë¹ÜÏÔÊ¾º¯Êı
  148          {
  149   1        u8 datcode,weicode;
  150   1        datcode = SEG_Code[dat];        //È¡Ê®½øÖÆdat¶ÔÓ¦µÄ¶ÎÂë
  151   1        weicode = WEI_Code[wei-1];      //È¡Ê®½øÖÆwei¶ÔÓ¦µÄÎ»Âë
  152   1        
  153   1        Write595(weicode);              //ÏÈ·¢Î»Âë
  154   1        Write595(datcode);              //ÔÙ·¢¶ÎÂë
  155   1        Output595();                    //595Êä³öÏÔÊ¾
  156   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       460     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        29     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        29     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
