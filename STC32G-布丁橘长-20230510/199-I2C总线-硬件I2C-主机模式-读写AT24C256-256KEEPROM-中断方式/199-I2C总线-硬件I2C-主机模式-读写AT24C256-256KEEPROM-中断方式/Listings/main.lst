C251 COMPILER V5.57.0,  main                                                               10/05/23  03:12:21  PAGE 1   


C251 COMPILER V5.57.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\SoftWare\KeilC251\C251\BIN\C251.EXE main.c XSMALL INTR2 BROWSE DEBUG PRINT(.\Listings\main.lst) 
                    -TABS(2) OBJECT(.\Objects\main.obj) 

stmt  level    source

    1          //  @²¼¶¡éÙ³¤ 2023/05/08
    2          //  Ó²¼þI2C£¬¶ÁÐ´AT24CxxxÏµÁÐEEPROMÊ¾Àý£¬I2CÏà¹Øº¯ÊýÒÑÔÚI2C_IO.c/hÖÐ¶¨Òå
    3          //  ±¾ÀýEEPROMÐÍºÅ£ºAT24C256¡¢AT24C64£¬4KÒÔ¼°ÒÔÉÏÈÝÁ¿EEPROMÊÊÓÃ
    4          //  1K¡¢2K EEPROMÐèÒª½«¶Á/Ð´º¯Êý£¬¸ÄÎª1¸ö×Ö½ÚµØÖ·º¯Êý£¨AT24Cxx.c/.hÖÐÒÑ¶¨Òå£©
    5          //  ÉÏµçºó·Ö±ð½«LED_Buffer1/Buffer2ÖÐµÄÁ÷Ë®µÆÂë±íÐ´ÈëEEPROM£¬whileÑ­»·ÖÐ·Ö±ðÊ¹ÓÃµ¥×Ö½Ú¶ÁÈ¡ºÍ¶à×Ö½Ú¶ÁÈ¡·½Ê½
             -£¬¶ÁÈ¡EEPROM
    6          //  ÊµÑéÐ§¹û£ºLED1-8µ¥¸öLEDÁ÷Ë®µÆ£¬¼ä¸ô200ms£¬Íê³Éºó£¬±äÎª2¸öLEDÁ÷Ë®µÆ£¬¼ä¸ô200ms
    7          //  I2CÊ¹ÓÃÒý½ÅP3.3(SDA) P3.2(SCL)
    8          //  ÊµÑé¿ª·¢°å£ºSTC32G12K128ÍÀÁúµ¶Èý.1 Ö÷Æµ@24MHz
    9          //  ±¾³ÌÐòI2CÐ­Òé²¿·Ö¡¢AT24CxxÏà¹Øº¯Êý£¬Ê¹ÓÃÁËSTC32GÊÖ²áÊ¾Àý³ÌÐò-I2CÖ÷»úÄ£Ê½·ÃÎÊAT24C256(ÖÐ¶Ï·½Ê½)
   10          
   11          #include <STC32G.H>
   12          #include "config.h"
   13          #include "AT24Cxx.h"
   14          #include "delay.h"
   15          
   16          bit B_1ms;
   17          u8 m,n;                       
   18          u16 count;                    // 200ºÁÃë¼ÆÊ±
   19          
   20          u8 LED_Buffer1[8]= {0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F}; // Á÷Ë®µÆÂë±í1£¬Ã¿´Î1¸öLEDÁ÷Ë®µÆ
   21          u8 LED_Buffer2[8]= {0xFC,0xF9,0xF3,0xE7,0xCF,0x9F,0x3F,0x7E}; // Á÷Ë®µÆÂë±í2£¬Ã¿´ÎÏàÁÚ2¸öLEDÁ÷Ë®µÆ
   22          u8 Dat_Buffer[8]={0};
   23          
   24          void sysini(void);            // STC32³õÊ¼»¯ÉèÖÃ
   25          void Timer0_Init(void);       // ¶¨Ê±Æ÷0³õÊ¼»¯
   26          
   27          void main(void)
   28          {
   29   1        sysini();                   // STC32³õÊ¼»¯ÉèÖÃ
   30   1        Timer0_Init();              // ¶¨Ê±Æ÷0³õÊ¼»¯
   31   1        
   32   1      //  I2C_S1 = 0;
   33   1      //  I2C_S0 = 1;               // I2CÒý½ÅÇÐ»»µ½P2.5(SCL) P2.4(SDA)
   34   1        
   35   1        I2C_S1 = 1;
   36   1        I2C_S0 = 1;                 // I2CÒý½ÅÇÐ»»µ½P3.3(SDA) P3.2(SCL) 
   37   1        
   38   1        I2CCFG = 0xCD;              // Ê¹ÄÜ I2C£¬Ö÷»úÄ£Ê½£¬×ÜÏßËÙ¶È400K
   39   1        I2CMSST = 0x00;             // ÇåÁã Ö÷»ú×´Ì¬±êÖ¾
   40   1        EA = 1;                     // Ê¹ÄÜEA×ÜÖÐ¶Ï
   41   1          
   42   1      //==================Ð´×Ö½ÚÄ£Ê½£¨Ð´Èë¼ä¸ôÐèÒª´óÓÚ5ºÁÃë£©====================
   43   1      for(m = 0;m<8;m++)
   44   1        {
   45   2          EEPROM_WriteAbyte(0x00,m,LED_Buffer1[m]);   // ÔÚµØÖ· 0x00 m £¬Ð´Èë1¸ö×Ö½Ú
   46   2          delayms(5);               // ÑÓÊ±5ºÁÃë£¨Ð´×Ö½ÚÄ£Ê½Ê±£¬STOPÐÅºÅ·¢³öºó£¬EEPROM½øÈë ×ÔÐ´ÈëÖÜÆÚ£¬ºÄÊ±×î¶à5ºÁÃë£©
   47   2        }
   48   1        
   49   1        
   50   1      //======================Ð´Ò³ÃæÄ£Ê½==========================================
   51   1        EEPROM_WriteNbyte(0x00,0x08,LED_Buffer2, 8);  // Ð´Èë¶à¸ö×Ö½Ú£¬¹²8×Ö½Ú£¨×î¶à²»ÄÜ³¬¹ýEEPROMµÄÒ³Ãæ´óÐ¡£©
   52   1      
   53   1        while (1)
   54   1        {
   55   2          if(B_1ms == 1)            // 1ºÁÃëµ½
   56   2          {
   57   3            B_1ms = 0;              // ÇåÁã1ºÁÃë±êÖ¾
C251 COMPILER V5.57.0,  main                                                               10/05/23  03:12:21  PAGE 2   

   58   3            count++;                // 200ºÁÃë¼ÆÊý+1
   59   3          } 
   60   2      
   61   2          if(count >= 200)          // 200ºÁÃëµ½
   62   2          {
   63   3            count = 0;              // ÇåÁã200ºÁÃë¼ÆÊ±¼ÆÊý
   64   3            
   65   3      //========================Ëæ»úµØÖ·¶ÁÈ¡£¨Ã¿´Î1¸ö×Ö½Ú£©========================   
   66   3            if(n < 8) P2 = EEPROM_ReadAbyte(0x00,n);    // ´ÓµØÖ·0x00 n ´¦£¬¶ÁÈ¡1¸ö×Ö½Ú
   67   3            
   68   3            
   69   3      //======================ÐòÁÐ¶ÁÈ¡(¶ÁÈ¡¶à¸ö×Ö½Ú)================================  
   70   3            if(n ==8) EEPROM_ReadNbyte(0x00,0x08,Dat_Buffer,8); // ´ÓµØÖ· 0x0008 ¿ªÊ¼£¬¶ÁÈ¡8¸ö×Ö½Ú£¬´æÈëDat_Buffer
             -[]ÖÐ
   71   3          
   72   3            
   73   3            if(n >= 8 && n <=15) P2 = Dat_Buffer[n-8];    // °´ÕÕ¶ÁÈ¡µÄÊý¾Ý£¬P2¿ÚÁ÷Ë®µÆ
   74   3            n++;                    // n¼ÆÊý·¶Î§0-15£¬Íê³É2´ÎµÆ
   75   3            n &= 0x0F;              // ·ÀÒç³ö£¬µ±n=15£¬¼´0x0F£¬µ±n´óÓÚ15£¬Óë²Ù×÷ÇåÁã¸ß4Î»£¬ÏÞ¶¨È¡Öµ·¶Î§0-15
   76   3          } 
   77   2        }
   78   1      }
   79          void sysini()
   80          {
   81   1        EAXFR = 1;                  // Ê¹ÄÜ·ÃÎÊ XFR
   82   1        CKCON = 0x00;               // ÉèÖÃÍâ²¿Êý¾Ý×ÜÏßËÙ¶ÈÎª×î¿ì
   83   1        WTST = 0x00;                // ÉèÖÃ³ÌÐò´úÂëµÈ´ý²ÎÊý£¬µÈ´ýÊ±¼äÎª0¸öÊ±ÖÓ£¬CPUÖ´ÐÐ³ÌÐòËÙ¶È×î¿ì
   84   1      
   85   1        P0M1 = 0x00;P0M0 = 0x00;    // ÉèÖÃP0¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   86   1        P1M1 = 0x00;P1M0 = 0x00;    // ÉèÖÃP1¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   87   1        P2M1 = 0x00;P2M0 = 0x00;    // ÉèÖÃP2¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   88   1        P3M1 = 0x0C;P3M0 = 0x0C;    // P3.2 P3.3¿ÚÎª¿ªÂ©Êä³ö  //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   89   1        P4M1 = 0x00;P4M0 = 0x00;    // ÉèÖÃP4¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   90   1        P5M1 = 0x00;P5M0 = 0x00;    // ÉèÖÃP5¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   91   1        P6M1 = 0x00;P6M0 = 0x00;    // ÉèÖÃP6¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   92   1        P7M1 = 0x00;P7M0 = 0x00;    // ÉèÖÃP7¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ //00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³
             -ö
   93   1      }
   94          void Timer0_Isr(void) interrupt 1
   95          {
   96   1        B_1ms = 1;                  // 1ºÁÃë±êÖ¾
   97   1      }
   98          void Timer0_Init(void)        //1ºÁÃë@22.1184MHz
   99          {
  100   1        AUXR |= 0x80;               //¶¨Ê±Æ÷Ê±ÖÓ1TÄ£Ê½
  101   1        TMOD &= 0xF0;               //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
  102   1        TL0 = 0x9A;                 //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
  103   1        TH0 = 0xA9;                 //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
  104   1        TF0 = 0;                    //Çå³ýTF0±êÖ¾
  105   1        TR0 = 1;                    //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
  106   1        ET0 = 1;                    //Ê¹ÄÜ¶¨Ê±Æ÷0ÖÐ¶Ï
  107   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       283     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
C251 COMPILER V5.57.0,  main                                                               10/05/23  03:12:21  PAGE 3   

  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        28     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        36     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
