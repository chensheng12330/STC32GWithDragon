C251 COMPILER V5.57.0,  key_multi_timer                                                    21/02/23  22:06:30  PAGE 1   


C251 COMPILER V5.57.0, COMPILATION OF MODULE key_multi_timer
OBJECT MODULE PLACED IN .\Objects\key_multi_timer.obj
COMPILER INVOKED BY: D:\SoftWare\KeilC251\C251\BIN\C251.EXE key_multi_timer.c XSMALL BROWSE DEBUG PRINT(.\Listings\key_m
                    -ulti_timer.lst) TABS(2) OBJECT(.\Objects\key_multi_timer.obj) 

stmt  level    source

    1          //¶à¹¦ÄÜ°´¼üº¯Êý£¬ÊµÏÖ°´¼ü£ºµ¥»÷¡¢Ë«»÷¡¢³¤°´
    2          //Õ¼ÓÃ¶¨Ê±Æ÷4£¬ÐèÒªÔÚÖ÷º¯Êý¶Ô¶¨Ê±Æ÷4³õÊ¼»¯£ºTimer4_Init();²¢Ê¹ÄÜÖÐ¶ÏEA=1
    3          
    4          #include <STC32G.H>
    5          #include "key_multi_timer.h"
    6          #include "config.h"
    7          
    8          static u8 keynumber;
    9          static u8 key_state;                  //°´¼ü×´Ì¬±äÁ¿
   10          static u16 key_time;                  //°´¼ü¼ÆÊ±±äÁ¿
   11          static u8 key_press_nums;             //°´¼ü´ÎÊý±äÁ¿    
   12          static u16 key_time_double;           //°´¼üË«»÷Ê±¼ä
   13          static u8 keynum;                     //¼üÖµ
   14          static u8 new_keynum;                 //ÐÂµÄ¼üÖµ
   15          u8 key_press, key_return;             //¼üÖµºÍ·µ»ØÖµ
   16            
   17          void Timer4_Isr(void) interrupt 20
   18          {
   19   1        key_time++; 
   20   1        if(key_press_nums > 0)
   21   1        {
   22   2          key_time_double++;
   23   2          if((key_time_double >DOUBLE_KEY_TIME )&&( key_time_double< LONG_KEY_TIME))  key_state = KEY_STATE_2;  
   24   2        }
   25   1      }
   26          void Timer4_Init(void)    //10ºÁÃë@12.000MHz
   27          {
   28   1        TM4PS = 0x01;     //ÉèÖÃ¶¨Ê±Æ÷Ê±ÖÓÔ¤·ÖÆµ ( ×¢Òâ:²¢·ÇËùÓÐÏµÁÐ¶¼ÓÐ´Ë¼Ä´æÆ÷,ÏêÇéÇë²é¿´Êý¾ÝÊÖ²á )
   29   1        T4T3M |= 0x20;      //¶¨Ê±Æ÷Ê±ÖÓ1TÄ£Ê½
   30   1        T4L = 0xA0;       //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
   31   1        T4H = 0x15;       //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
   32   1        T4T3M |= 0x80;      //¶¨Ê±Æ÷4¿ªÊ¼¼ÆÊ±
   33   1        IE2 |= 0x40;      //Ê¹ÄÜ¶¨Ê±Æ÷4ÖÐ¶Ï
   34   1      }
   35          
   36          u8 key_multi(void)
   37          { 
   38   1        key_return = None_click;                  //Çå³ý·µ»Ø°´¼üÖµ
   39   1        if(!KEY1) {key_press = KEY1;new_keynum = 1;}                  
   40   1        else if(!KEY2) {key_press = KEY2;new_keynum = 2;}             
   41   1        else if(!KEY3) {key_press = KEY3;new_keynum = 3;}             
   42   1        else if(!KEY4) {key_press = KEY4;new_keynum = 4;}             
   43   1        else key_press = 1;
   44   1          
   45   1        switch (key_state)
   46   1        {
   47   2          case KEY_STATE_0:                       //°´¼ü×´Ì¬0£ºÅÐ¶ÏÓÐÎÞ°´¼ü°´ÏÂ
   48   2          {
   49   3            if (!key_press)                       //ÓÐ°´¼ü°´ÏÂ
   50   3            {
   51   4              key_time = 0;                       //ÇåÁãÊ±¼ä¼ä¸ô¼ÆÊý
   52   4              
   53   4              key_state = KEY_STATE_1;            //È»ºó½øÈë °´¼ü×´Ì¬1
   54   4            }
   55   3          }break;
   56   2          case KEY_STATE_1:                       //°´¼ü×´Ì¬1£ºÈí¼þÏû¶¶(È·¶¨°´¼üÊÇ·ñÓÐÐ§£¬¶ø²»ÊÇÎó´¥)¡£°´¼üÓÐÐ§µÄ¶¨Òå£º°´¼ü³
             -ÖÐø°´ÏÂ³¬¹ýÉè¶¨µÄÏû¶¶Ê±¼ä¡£
   57   2          {
C251 COMPILER V5.57.0,  key_multi_timer                                                    21/02/23  22:06:30  PAGE 2   

   58   3            if (!key_press)
   59   3            {
   60   4              TR0 = 1;
   61   4              if(key_time>=SINGLE_KEY_TIME )      //Ïû¶¶Ê±¼äÎª£ºSINGLE_KEY_TIME*10ms = 10ms;
   62   4              {
   63   5                key_state = KEY_STATE_2;          //Èç¹û°´¼üÊ±¼ä³¬¹ý Ïû¶¶Ê±¼ä£¬¼´ÅÐ¶¨Îª°´ÏÂµÄ°´¼üÓÐÐ§¡£½øÈë°´¼ü×´Ì¬2£¬¼Ì
             -ÐøÅÐ¶¨µ½µ×ÊÇµ¥»÷¡¢Ë«»÷»¹ÊÇ³¤°´
   64   5                key_press_nums++;                 //°´¼ü´ÎÊý+1
   65   5              }
   66   4            }
   67   3            else key_state = KEY_STATE_0;         //Èç¹û°´¼üÊ±¼äÃ»ÓÐ³¬¹ý£¬ÅÐ¶¨ÎªÎó´¥£¬°´¼üÎÞÐ§£¬·µ»Ø °´¼ü×´Ì¬0£¬¼ÌÐøµÈ
             -´ý°´¼ü
   68   3          }break;
   69   2          case KEY_STATE_2:                       //°´¼ü×´Ì¬2£ºÅÐ¶¨°´¼üÓÐÐ§µÄÖÖÀà£ºÊÇµ¥»÷£¬Ë«»÷£¬»¹ÊÇ³¤°´
   70   2          {
   71   3            if(key_press)                         //Èç¹û°´¼üÔÚ Éè¶¨µÄË«»÷Ê±¼äÄÚÊÍ·Å£¬ÔòÅÐ¶¨Îªµ¥»÷/Ë«»÷
   72   3            {
   73   4              if(key_time_double <= DOUBLE_KEY_TIME ) key_state = KEY_STATE_0;            //Ë«»÷Ê±¼ä´ïµ½Ç°£¬ÔÙ´ÎÉ¨Ãè°´¼ü
   74   4              if((key_time_double >DOUBLE_KEY_TIME )&&( key_time_double< LONG_KEY_TIME))  //´ïµ½Ë«»÷Éè¶¨Ê±¼äºó
   75   4              {
   76   5                if(key_press_nums == 1)
   77   5                { TR0 = 0;key_return = Single_click + new_keynum*10;
   78   6                  key_state = KEY_STATE_0;          //·µ»Ø °´¼ü×´Ì¬0£¬¼ÌÐøµÈ´ý°´¼ü
   79   6                key_press_nums = 0;               //Çå¿Õ°´¼ü´ÎÊý
   80   6                key_time_double = 0;              //Çå¿ÕË«»÷¼ÆÊ±
   81   6                }       //·µ»ØÓÐÐ§°´¼üÖµ£ºµ¥»÷
   82   5                else if(key_press_nums >=2 && new_keynum == keynum) 
   83   5                {
   84   6                TR0 = 0;key_return = Double_click + new_keynum*10;
   85   6                key_state = KEY_STATE_0;          //·µ»Ø °´¼ü×´Ì¬0£¬¼ÌÐøµÈ´ý°´¼ü
   86   6                key_press_nums = 0;               //Çå¿Õ°´¼ü´ÎÊý
   87   6                key_time_double = 0;              //Çå¿ÕË«»÷¼ÆÊ±
   88   6                }//·µ»ØÓÐÐ§°´¼üÖµ£ºË«»÷
   89   5              }
   90   4            }
   91   3            else
   92   3            { 
   93   4              if(key_time >= LONG_KEY_TIME)       //Èç¹û°´¼üÊ±¼ä³¬¹ý Éè¶¨µÄ³¤°´Ê±¼ä(LONG_KEY_TIME*10ms=80*10ms=800ms),
             - ÔòÅÐ¶¨Îª ³¤°´
   94   4              {
   95   5                TR0 = 0;
   96   5                key_return = Long_click + new_keynum*10;  //·µ»ØÓÐÐ§¼üÖµÖµ£º³¤°´
   97   5                key_state = KEY_STATE_3;          //È¥×´Ì¬3£¬µÈ´ý°´¼üÊÍ·Å
   98   5              }
   99   4            }
  100   3          }break;
  101   2          case KEY_STATE_3:                       //µÈ´ý°´¼üÊÍ·Å
  102   2          {
  103   3            if (key_press)
  104   3            {
  105   4              key_state = KEY_STATE_0;            //°´¼üÊÍ·Åºó£¬½øÈë °´¼ü×´Ì¬0 £¬½øÐÐÏÂÒ»´Î°´¼üµÄÅÐ¶¨
  106   4              key_press_nums = 0;                 //Çå¿Õ°´¼ü´ÎÊý
  107   4              key_time_double=0;
  108   4              TR0 = 0;
  109   4            }
  110   3          }break;
  111   2          default:{key_state = KEY_STATE_0;}break;  //ÌØÊâÇé¿ö£ºkey_stateÊÇÆäËûÖµµÃÇé¿ö£¬ÇåÁãkey_state¡£ÕâÖÖÇé¿öÒ»
             -°ã³öÏÖÔÚ Ã»ÓÐ³õÊ¼»¯key_state£¬µÚÒ»´ÎÖ´ÐÐÕâ¸öº¯ÊýµÄÊ±ºò
  112   2        }
  113   1        keynum = new_keynum;                      //½«ÐÂ»ñÈ¡µÄ¼üÖµ¸³Öµ¸ø¼üÖµ
  114   1        return key_return;                        //·µ»Ø °´¼üÖµ
  115   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       460     ------
C251 COMPILER V5.57.0,  key_multi_timer                                                    21/02/23  22:06:30  PAGE 3   

  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        11     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
