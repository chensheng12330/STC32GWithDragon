C251 COMPILER V5.57.0,  main                                                               21/02/23  22:15:07  PAGE 1   


C251 COMPILER V5.57.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\SoftWare\KeilC251\C251\BIN\C251.EXE main.c XSMALL BROWSE DEBUG PRINT(.\Listings\main.lst) TABS(2
                    -) OBJECT(.\Objects\main.obj) 

stmt  level    source

    1          //    @²¼¶¡éÙ³¤ 2023/02/03
    2          //    ¶ÀÁ¢°´¼ü-°´¼üKEY1ÊıÂë¹ÜÊı×Ö¼Ó£¬°´¼üKEY2ÊıÂë¹ÜÊı×Ö¼õ£¬°´¼üKEY3ÊıÂë¹ÜÏÔÊ¾88888888£¬°´¼üKEY4·µ»ØÏÔÊ¾Êı×Ö
    3          //    ¿ª·¢°å°åÔØ°´¼ü£ºKEY1-P3.2£¬KEY2-P3.3£¬KEY3-P3.4£¬KEY4-P3.5
    4          //    8Î»ÊıÂë¹ÜÄ£¿é£¨2Æ¬595¼¶ÁªÇı¶¯£©-¹²Ñô¼«ÊıÂë¹Ü
    5          //    ÊıÂë¹ÜÒı½Å¶¨Òå£ºDS(DIO)-P2.2£¬SH(SCK)-P2.1£¬ST(RCK)-P2.0
    6          //    ÊµÑé¿ª·¢°å£ºSTC32G12K128-LQFP64 ÍÀÁúµ¶Èı.1  35MHz
    7          
    8          #include <STC32G.H>
    9          
   10          #define MAIN_Fosc 35000000UL    //¶¨ÒåÖ÷Æµ35MHz£¬Çë¸ù¾İÊµ¼ÊÊ¹ÓÃÆµÂÊĞŞ¸Ä£¨ÓÃÓÚdelayº¯Êı×ÔÊÊÓ¦Ö÷Æµ£©
   11          
   12          typedef unsigned char u8;       //unsigned char     ÀàĞÍÓÃ u8 ±íÊ¾
   13          typedef unsigned int u16;       //unsigned int      ÀàĞÍÓÃ u16±íÊ¾
   14          typedef unsigned long int u32;  //unsigned long int ÀàĞÍÓÃ u32±íÊ¾
   15          
   16          sbit DS = P2^2;     //´®ĞĞÊäÈëDS(DIO)½ÓP2.2
   17          sbit SH = P2^1;     //´®ĞĞÊäÈëÊ±ÖÓSH(SCK)½ÓP2.1
   18          sbit ST = P2^0;     //Êä³öËø´æÊ±ÖÓST(RCK)½ÓP2.0
   19          sbit KEY1 = P3^2;   //°åÔØ°´¼ü£¬KEY1-P3.2
   20          sbit KEY2 = P3^3;   //°åÔØ°´¼ü£¬KEY2-P3.3
   21          sbit KEY3 = P3^4;   //°åÔØ°´¼ü£¬KEY3-P3.4
   22          sbit KEY4 = P3^5;   //°åÔØ°´¼ü£¬KEY4-P3.5
   23          
   24          void delayms(u16 ms);           //ÑÓÊ±º¯ÊıÉùÃ÷
   25          void keyscan();                 //°´¼üÉ¨Ãèº¯Êı      
   26          void Write595(u8 dat);          //595Ğ´Êı¾İº¯ÊıÉùÃ÷
   27          void Output595();               //595Êä³öÏÔÊ¾º¯ÊıÉùÃ÷
   28          void SEG_Disp(u8 dat,u8 wei);   //ÊıÂë¹ÜÏÔÊ¾º¯Êı
   29          
   30          
   31          //¹²Ñô¼«¶ÎÂëÊı×é
   32          u8 SEG_Code[13] = {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,   //¹²ÑôÊıÂë¹Ü¶ÎÂë£º0~9,  
   33                              0xff,0xbf,0x00};  //ÊıÂë¹ÜÈ«Ãğ£¨10£©£¬ºá¸Ë-£¨11£©£¬ÊıÂë¹ÜÈ«ÁÁ£¨12£©
   34          //¹²Ñô¼«Î»ÂëÊı×é-4Î»ÊıÂë¹Ü
   35          //u8 WEI_Code[8] = {0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};   //¹²Ñô¼«Î»ÂëÊı×é£¬COM1½Ó595Q0£¬COM2½ÓQ1...
             -¼´ÊıÂë¹Ü×ó±ßµÚÒ»Î»½ÓQ0...µÚ°ËÎ»½ÓQ7
   36          u8 WEI_Code[8] = {0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};   //¹²Ñô¼«Î»ÂëÊı×é£¬COM1½Ó595Q7£¬COM2½ÓQ6...¼´
             -ÊıÂë¹Ü×ó±ßµÚÒ»Î»½ÓQ7...µÚ°ËÎ»½ÓQ0
   37              
   38          u8 k1,k2,k3,k4,seg; //È«¾Ö±äÁ¿-KEY1£¬KEY2,KEY3,KEY4×´Ì¬£¬ÊıÂë¹Ü×´Ì¬
   39          u8 number;          //È«¾Ö±äÁ¿-number:ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö        
   40          
   41          void main()
   42          {
   43   1        u8 i;             //¾Ö²¿±äÁ¿-i£ºÓÃÓÚforÑ­»·
   44   1        
   45   1        EAXFR = 1;        //Ê¹ÄÜXFR·ÃÎÊ
   46   1        CKCON = 0x00;     //ÉèÖÃÍâ²¿Êı¾İ×ÜÏßËÙ¶È×î¿ì
   47   1        WTST = 0x00;      //ÉèÖÃ³ÌĞò¶ÁÈ¡µÈ´ıÊ±¼äÎª0¸öÊ±ÖÓ£¬CPUÖ´ĞĞ³ÌĞòËÙ¶È×î¿ì
   48   1        
   49   1        P0M1 = 0x00;P0M0 = 0x00;    //ÉèÖÃP0¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   50   1        P1M1 = 0x00;P1M0 = 0x00;    //ÉèÖÃP1¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   51   1        P2M1 = 0x00;P2M0 = 0x00;    //ÉèÖÃP2¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   52   1        P3M1 = 0x00;P3M0 = 0x00;    //ÉèÖÃP3¿ÚÎª×¼Ë«Ïò¿ÚÄ£Ê½ 00£º×¼Ë«Ïò¿Ú 01£ºÍÆÍìÊä³ö 10£º¸ß×èÊäÈë 11£º¿ªÂ©Êä³ö
   53   1        
   54   1        while(1)
   55   1        {
   56   2          keyscan();
C251 COMPILER V5.57.0,  main                                                               21/02/23  22:15:07  PAGE 2   

   57   2          if(seg == 1)                    //ÊıÂë¹ÜÏÔÊ¾±êÖ¾Îª1Ê±£¬ÏÔÊ¾88888888
   58   2          {
   59   3            for(i = 1;i < 9;i++)
   60   3            {
   61   4              SEG_Disp(8,i);              //ÊıÂë¹Ü8Î»¶¼ÏÔÊ¾8
   62   4              delayms(1);
   63   4            }
   64   3          }
   65   2          else                            //ÊıÂë¹ÜÏÔÊ¾±êÖ¾Îª0Ê±£¬ÏÔÊ¾Êı×Ö
   66   2          {
   67   3            for(i = 1;i < 7;i++)
   68   3            {
   69   4              SEG_Disp(10,i);             //ÊıÂë¹Ü×ó±ß6Î»Ï¨Ãğ
   70   4              delayms(1);
   71   4            }
   72   3            SEG_Disp((u8)(number/10),7);  //µÚ7Î»ÏÔÊ¾Êı×ÖÊ®Î»
   73   3            delayms(1);
   74   3            SEG_Disp((u8)(number%10),8);  //µÚ8Î»ÏÔÊ¾Êı×Ö¸öÎ»
   75   3            delayms(1);
   76   3          }
   77   2        }
   78   1      }
   79          
   80          void  delayms(u16 ms)   //¼òµ¥ÑÓÊ±º¯Êı£¬×ÔÊÊÓ¦Ö÷Æµ£¬1ºÁÃë*ms
   81          {
   82   1        u16 i;
   83   1        do{
   84   2            i = MAIN_Fosc / 6000;
   85   2            while(--i);
   86   2          }while(--ms);
   87   1      }
   88          void keyscan()
   89          {
   90   1        if(KEY1 == 0 && k1 == 0)          //ÅĞ¶Ï°´¼üKEY1ÊÇ·ñ°´ÏÂ£¬Ö»ÓĞÔÚ°´¼üÊÇËÉ¿ª×´Ì¬²Å»á½øÈëif
   91   1        { 
   92   2          delayms(10);                    //ÑÓÊ±Ïû¶¶
   93   2          if(KEY1 == 0 && k1 == 0)        //ÔÙ´ÎÅĞ¶ÏKEY1ÊÇ·ñ°´ÏÂ£¬Ö»ÓĞÔÚ°´¼üÊÇËÉ¿ª×´Ì¬²Å»á½øÈëif
   94   2          {
   95   3            if(number < 99) number++;     //ÊıÂë¹ÜÏÔÊ¾µÄÊı×Ö+1,number×î´óÖµ99
   96   3            k1 = 1;                       //°´¼üËÉ¿ªÇ°·ÀÖ¹ÖØ¸´½øÈë£¬·ÀÖ¹numberÒ»Ö±Ôö¼Ó£¬ËÉ¿ª°´¼üÇ°²»ÔÙÅĞ¶Ï½øÈëif
   97   3          }
   98   2        }
   99   1        if(KEY1 == 1) k1 = 0;             //ËÉ¿ªKEY1°´¼üºó£¬ÇåÁãk1
  100   1        
  101   1        if(KEY2 == 0 && k2 == 0)          //ÅĞ¶Ï°´¼üKEY2ÊÇ·ñ°´ÏÂ£¬Ö»ÓĞÔÚ°´¼üÊÇËÉ¿ª×´Ì¬²Å»á½øÈëif
  102   1        {
  103   2          delayms(10);                    //ÑÓÊ±Ïû¶¶
  104   2          if(KEY2 == 0 && k2 == 0)        //°´¼üËÉ¿ªÇ°·ÀÖ¹ÖØ¸´½øÈë£¬ÔÙ´ÎÅĞ¶ÏKEY1ÊÇ·ñ°´ÏÂ£¬Ö»ÓĞÔÚ°´¼üÊÇËÉ¿ª×´Ì¬²Å»á½øÈ
             -ëif
  105   2          {
  106   3            if(number >= 1) number--;     //number×îĞ¡Öµ0
  107   3            k2 = 1;       
  108   3          }
  109   2        }
  110   1        if(KEY2 == 1) k2 = 0;             //ËÉ¿ªKEY2°´¼üºó£¬ÇåÁãk2
  111   1        
  112   1        if(KEY3 == 0 && k3 == 0)          //ÅĞ¶Ï°´¼üKEY3ÊÇ·ñ°´ÏÂ
  113   1        {
  114   2          delayms(10);                    //ÑÓÊ±Ïû¶¶
  115   2          if(KEY3 == 0 && k3 == 0)        //ÔÙ´ÎÅĞ¶ÏKEY1ÊÇ·ñ°´ÏÂ
  116   2          {
  117   3            seg = 1;                      //ÊıÂë¹Ü×´Ì¬ÖÃ1£¬ÏÔÊ¾88888888
  118   3            k3 = 1;                       //°´¼üËÉ¿ªÇ°·ÀÖ¹ÖØ¸´½øÈë
  119   3          }
  120   2        }
  121   1        if(KEY3 == 1) k3 = 0;             //ËÉ¿ªKEY3°´¼üºó£¬ÇåÁãk3
C251 COMPILER V5.57.0,  main                                                               21/02/23  22:15:07  PAGE 3   

  122   1        
  123   1        if(KEY4 == 0 && k4 == 0)          //ÅĞ¶Ï°´¼üKEY4ÊÇ·ñ°´ÏÂ
  124   1        {
  125   2          delayms(10);                    //ÑÓÊ±Ïû¶¶
  126   2          if(KEY4 == 0 && k4 == 0)        //ÔÙ´ÎÅĞ¶ÏKEY1ÊÇ·ñ°´ÏÂ
  127   2          {
  128   3            seg = 0;                      //ÇåÁãÊıÂë¹Ü×´Ì¬£¬ÏÔÊ¾Êı×Ö
  129   3            k4 = 1;                       //°´¼üËÉ¿ªÇ°·ÀÖ¹ÖØ¸´½øÈë
  130   3          }
  131   2        }
  132   1        if(KEY4 == 1) k4 = 0;             //ËÉ¿ªKEY4°´¼üºó£¬ÇåÁãk4
  133   1      }
  134          void Write595(u8 dat)     //595Ğ´Êı¾İº¯Êı
  135          {
  136   1        u16 i;
  137   1        for(i = 0;i < 8;i++)    
  138   1        {
  139   2          SH = 0;               //À­µÍ´®ĞĞÊäÈëÊ±ÖÓSCLK
  140   2          DS = dat & 0x80;      //È¡×î¸ßÎ»
  141   2          SH = 1;               //SCKLÊ±ÖÓÉÏÉıÑØ£¬Êı¾İ´æÒÆÎ»¼Ä´æÆ÷
  142   2          dat <<= 1;            //Ã¿´ÎÒ»Î»
  143   2        }
  144   1      }
  145          void Output595()          //595Êä³öº¯Êı
  146          {
  147   1        ST = 0;                 //À­µÍSTÊ±ÖÓ
  148   1        ST = 1;                 //STÊ±ÖÓÉÏÉıÑØ£¬¸üĞÂÊä³ö´æ´¢Æ÷Êı¾İ
  149   1      }
  150          
  151          void SEG_Disp(u8 dat,u8 wei)      //ÊıÂë¹ÜÏÔÊ¾º¯Êı
  152          {
  153   1        u8 datcode,weicode;
  154   1        datcode = SEG_Code[dat];        //È¡Ê®½øÖÆdat¶ÔÓ¦µÄ¶ÎÂë
  155   1        weicode = WEI_Code[wei-1];      //È¡Ê®½øÖÆwei¶ÔÓ¦µÄÎ»Âë
  156   1        
  157   1        Write595(datcode);              //ÏÈ·¢¶ÎÂë
  158   1        Write595(weicode);              //ÔÙ·¢Î»Âë
  159   1        Output595();                    //595Êä³öÏÔÊ¾
  160   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       447     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        27     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        29     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
