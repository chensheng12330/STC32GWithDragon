#include "NTC.h"
#include "config.h"

extern u16 adc_result;					//	ADC转换结果;

u16 temp_table[]={ 	//10KB3950
        3983,			//0：-40℃
				3975,			//1: -39℃
				3967,			//2：-38℃
				3958,			//3：-37℃
				3949,			//4：-36℃
				3940,			//5：-35℃
				3929,			//6：-34℃
				3919,			//7：-33℃
				3907,			//8：-32℃
				3896,			//9：-31℃
				3883,			//10：-30℃
				3870,			//11：-29℃
				3856,			//12：-28℃
				3842,			//13：-27℃
				3827,			//14：-26℃
				3811,			//15：-25℃
				3795,			//16：-24℃
				3777,			//17：-23℃
				3759,			//18：-22℃
				3740,			//19：-21℃
				3721,			//20：-20℃
				3700,			//21：-19℃
				3679,			//22：-18℃
				3656,			//23：-17℃
				3633,			//24：-16℃
				3609,			//25：-15℃
				3585,			//26：-14℃
				3559,			//27：-13℃
				3532,			//28：-12℃
				3505,			//29：-11℃
				3476,			//30：-10℃
				3447,			//31：-9℃
				3416,			//32：-8℃
				3385,			//33：-7℃
				3353,			//34：-6℃
				3320,			//35：-5℃
				3286,			//36：-4℃
				3251,			//37：-3℃
				3215,			//38：-2℃
				3179,			//39：-1℃
				3142,			//40: 0℃
				3104,			//41: 1℃
				3065,			//42: 2℃
				3025,			//43: 3℃
				2985,			//44: 4℃
				2944,			//45: 5℃
				2902,			//46: 6℃
				2860,			//47: 7℃
				2817,			//48: 8℃
				2774,			//49: 9℃
				2730,			//50: 10℃
				2686,			//51: 11℃
				2641,			//52: 12℃
				2596,			//53: 13℃
				2551,			//54: 14℃
				2505,			//55: 15℃
				2460,			//56: 16℃
				2414,			//57: 17℃
				2368,			//58: 18℃
				2322,			//59: 19℃
				2276,			//60: 20℃
				2230,			//61: 21℃
				2184,			//62: 22℃
				2139,			//63: 23℃
				2093,			//64: 24℃
				2048, 		//65: 25℃
				2003,			//66: 26℃
				1958,			//67: 27℃
				1914,			//68: 28℃
				1870,			//69: 29℃
				1826,			//70: 30℃
				1783,			//71: 31℃
				1741,			//72: 32℃
				1699,			//73: 33℃
				1657,			//74: 34℃
				1616,			//75: 35℃
				1576,			//76: 36℃
				1536,			//77: 37℃
				1497,			//78: 38℃
				1459,			//79: 39℃
				1421,			//80: 40℃
				1384,			//81: 41℃
				1347,			//82: 42℃
				1311,			//83: 43℃
				1277,			//84: 44℃
				1242,			//85: 45℃
				1209,			//86: 46℃
				1176,			//87: 47℃
				1144,			//88: 48℃
				1112,			//89: 49℃
				1082,			//90: 50℃
				1052,			//91: 51℃
				1022,			//92: 52℃
				994,			//93: 53℃
				966,			//94: 54℃
				939,			//95: 55℃
				912,			//96: 56℃
				886,			//97: 57℃
				861,			//98: 58℃
				837,			//99: 59℃
				813,			//100: 60℃
				790,			//101: 61℃
				767,			//102: 62℃
				745,			//103: 63℃
				724,			//104: 64℃
				703,			//105: 65℃
				683,			//106: 66℃
				663,			//107: 67℃
				644,			//108: 68℃
				626,			//109: 69℃
				608,			//110: 70℃
				590,			//111: 71℃
				573,			//112: 72℃
				557,			//113: 73℃
				541,			//114: 74℃
				525,			//115: 75℃
				510,			//116: 76℃
				496,			//117: 77℃
				481,			//118: 78℃
				468,			//119: 79℃
				454,			//120: 80℃
				441,			//121: 81℃
				429,			//122: 82℃
				417,			//123: 83℃
				405,			//124: 84℃
				394,			//125: 85℃
				382,			//126: 86℃
				372,			//127: 87℃
				361,			//128: 88℃
				351,			//129: 89℃
				341,			//130: 90℃
				332,			//131: 91℃
				323,			//132: 92℃
				314,			//133: 93℃
				305,			//134: 94℃
				297,			//135: 95℃
				289,			//136: 96℃
				280,			//137: 97℃
				273,			//138: 98℃
				265,			//139: 99℃
				258,			//140: 100℃
				251,			//141: 101℃
				245,			//142: 102℃
				238,			//143: 103℃
				231,			//144: 104℃
				225,			//145: 105℃
				219,			//146: 106℃
				214,			//147: 107℃
				208,			//148: 108℃
				202,			//149: 109℃
				197,			//150: 110℃
				192,			//151: 111℃
				187,			//152: 112℃
				182,			//153: 113℃
				177,			//154: 114℃
				173,			//155: 115℃
				168,			//156: 116℃
				164,			//157: 117℃
				159,			//158: 118℃
				156,			//159: 119℃
				151 			//160：120℃
};

float CalculationTemperature(u16 adc)
{
	float temper,temper_float;
  u16 min,middle,max;
	float temp1,temp2;
  min = 0;        			//-40度
  max = 160;      			//120度
	
   if(adc == temp_table[min])  temper = min - 40;
   else if(adc == temp_table[max])  temper = max - 40;
   while(min <= max)																			// 二分搜索法
   {
			middle = (min + max) / 2;
      if(adc == temp_table[middle]) temper = middle - 40;
      if(adc > temp_table[middle]) max = middle - 1;
			else min = middle + 1;
      if(min >= max)
			{
				temp1 = temp_table[max]-adc;
				temp2 = temp_table[max-1] - temp_table[max];
				temper_float = temp1 / temp2;
				temper = max + temper_float - 40;
      }
    }
   return temper;
}